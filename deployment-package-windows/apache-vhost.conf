# Apache Virtual Host Configuration untuk Next.js
# Simpan di: C:\xampp\apache\conf\extra\httpd-vhosts.conf

<VirtualHost *:80>
    ServerName YOUR_SERVER_IP
    # Atau gunakan domain: ServerName monitoring.yourdomain.com
    
    # Enable reverse proxy
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Proxy ke Next.js app (port 3000)
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # WebSocket support untuk Next.js development/hot reload
    ProxyPass /_next/webpack-hmr ws://localhost:3000/_next/webpack-hmr
    ProxyPassReverse /_next/webpack-hmr ws://localhost:3000/_next/webpack-hmr
    
    # Headers untuk Next.js
    Header always set X-Forwarded-Proto "http"
    Header always set X-Forwarded-Host "%{HTTP_HOST}s"
    Header always set X-Real-IP "%{REMOTE_ADDR}s"
    Header always set X-Forwarded-For "%{REMOTE_ADDR}s"
    
    # Enable compression
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Cache static assets
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header append Cache-Control "public, immutable"
    </LocationMatch>
    
    # Error handling
    ErrorLog "logs/monitoring-error.log"
    CustomLog "logs/monitoring-access.log" combined
    
    # Error documents
    ErrorDocument 404 "http://localhost:3000/404"
    ErrorDocument 500 "http://localhost:3000/500"
</VirtualHost>

# Optional: HTTPS Configuration
# Uncomment dan konfigurasi SSL certificate jika diperlukan
# <VirtualHost *:443>
#     ServerName YOUR_SERVER_IP
#     
#     SSLEngine on
#     SSLCertificateFile "C:/xampp/apache/conf/ssl/server.crt"
#     SSLCertificateKeyFile "C:/xampp/apache/conf/ssl/server.key"
#     
#     # Redirect HTTP ke HTTPS
#     RewriteEngine On
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [L,R=301]
#     
#     # Copy semua konfigurasi dari VirtualHost *:80 di atas
# </VirtualHost>